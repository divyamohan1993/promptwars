<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="QuestForge: The Upside Down â€” A Stranger Things inspired interactive adventure game powered by Google Gemini AI.">
  <meta name="theme-color" content="#8b0000">
  <meta name="color-scheme" content="dark">
  <title>QuestForge: The Upside Down</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Press+Start+2P&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/animations.css">
  <link rel="stylesheet" href="css/map.css">
</head>
<body>
  <!-- Skip to content link for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Live region for screen reader announcements -->
  <div id="sr-announcer" class="sr-only" aria-live="assertive" aria-atomic="true" role="status"></div>

  <!-- Christmas Lights Decoration -->
  <div class="christmas-lights" aria-hidden="true">
    <span class="light light--red"></span>
    <span class="light light--yellow"></span>
    <span class="light light--green"></span>
    <span class="light light--blue"></span>
    <span class="light light--red"></span>
    <span class="light light--yellow"></span>
    <span class="light light--green"></span>
    <span class="light light--blue"></span>
    <span class="light light--red"></span>
    <span class="light light--yellow"></span>
    <span class="light light--green"></span>
    <span class="light light--blue"></span>
    <span class="light light--red"></span>
    <span class="light light--yellow"></span>
    <span class="light light--green"></span>
    <span class="light light--blue"></span>
    <span class="light light--red"></span>
    <span class="light light--yellow"></span>
    <span class="light light--green"></span>
    <span class="light light--blue"></span>
  </div>

  <!-- Header -->
  <header class="site-header" role="banner">
    <div class="header-inner">
      <h1 class="site-title flickering-title">
        QuestForge
      </h1>
      <p class="site-tagline">The Upside Down</p>
      <div class="header-controls">
        <select id="language-select" class="language-select" aria-label="Select language">
          <option value="en" lang="en">English</option>
          <option value="es" lang="es">Espa&#241;ol</option>
          <option value="fr" lang="fr">Fran&#231;ais</option>
          <option value="de" lang="de">Deutsch</option>
          <option value="ja" lang="ja">&#26085;&#26412;&#35486;</option>
          <option value="hi" lang="hi">&#2361;&#2367;&#2344;&#2381;&#2342;&#2368;</option>
          <option value="pt" lang="pt">Portugu&#234;s</option>
          <option value="zh" lang="zh">&#20013;&#25991;</option>
        </select>
        <button id="btn-sound-toggle" class="btn btn--icon" type="button" aria-label="Toggle sound effects" aria-pressed="true">
          <span class="sound-icon" aria-hidden="true">&#128266;</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main id="main-content" role="main">

    <!-- ==================== START SCREEN ==================== -->
    <section id="start-screen" class="screen screen--active" aria-labelledby="start-heading">
      <div class="container">
        <div class="welcome-card">
          <h2 id="start-heading" class="screen-heading">Choose Your Adventure</h2>
          <p class="welcome-text">
            Strange things are happening in Hawkins! Pick your name, choose an adventure,
            and be the hero of your own story.
          </p>

          <!-- Player Name Input -->
          <div class="form-group">
            <label for="player-name" class="form-label">Your Hero Name</label>
            <input
              type="text"
              id="player-name"
              class="form-input"
              placeholder="Type your name here..."
              required
              autocomplete="off"
              maxlength="50"
              aria-required="true"
              aria-describedby="name-hint"
            >
            <span id="name-hint" class="form-hint">What should we call you, hero?</span>
          </div>

          <!-- Adventure Selection -->
          <fieldset class="adventure-fieldset">
            <legend class="adventure-legend">Pick Your Adventure</legend>
            <div class="adventure-grid" role="radiogroup" aria-label="Adventure selection">

              <label class="adventure-card" data-adventure="hawkins-investigation">
                <input type="radio" name="adventure" value="hawkins-investigation" class="adventure-radio sr-only" aria-label="Hawkins Investigation">
                <span class="adventure-icon" aria-hidden="true">&#128294;</span>
                <span class="adventure-name">Hawkins Mystery</span>
                <span class="adventure-desc">Investigate strange lights and sounds!</span>
              </label>

              <label class="adventure-card" data-adventure="upside-down">
                <input type="radio" name="adventure" value="upside-down" class="adventure-radio sr-only" aria-label="The Upside Down">
                <span class="adventure-icon" aria-hidden="true">&#127744;</span>
                <span class="adventure-name">Upside Down</span>
                <span class="adventure-desc">Explore a spooky mirror world!</span>
              </label>

              <label class="adventure-card" data-adventure="hawkins-lab">
                <input type="radio" name="adventure" value="hawkins-lab" class="adventure-radio sr-only" aria-label="Hawkins Lab Escape">
                <span class="adventure-icon" aria-hidden="true">&#128300;</span>
                <span class="adventure-name">Lab Escape</span>
                <span class="adventure-desc">Use your powers to escape!</span>
              </label>

              <label class="adventure-card" data-adventure="dnd-campaign">
                <input type="radio" name="adventure" value="dnd-campaign" class="adventure-radio sr-only" aria-label="D&amp;D Campaign">
                <span class="adventure-icon" aria-hidden="true">&#127922;</span>
                <span class="adventure-name">D&amp;D Quest</span>
                <span class="adventure-desc">Roll dice and fight monsters!</span>
              </label>

            </div>
          </fieldset>

          <!-- Validation message -->
          <div id="start-error" class="error-message" role="alert" aria-live="polite" hidden></div>

          <!-- Begin Quest Button -->
          <button id="btn-start" class="btn btn--primary btn--large" type="button" aria-label="Begin your adventure">
            <span class="btn-text">Start Adventure!</span>
            <span class="btn-icon" aria-hidden="true">&#9889;</span>
          </button>
        </div>
      </div>
    </section>

    <!-- ==================== GAME SCREEN ==================== -->
    <section id="game-screen" class="screen" aria-labelledby="game-heading" hidden>
      <div class="container game-layout">
        <h2 id="game-heading" class="sr-only" tabindex="-1">Game in Progress</h2>

        <!-- Stats Bar with Hearts -->
        <div class="stats-bar" role="region" aria-label="Player statistics">
          <div class="stat stat--hearts">
            <span class="stat-label" id="health-label">Health</span>
            <div class="hearts-display" id="hearts-display" role="img" aria-labelledby="health-label" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
              <span class="heart heart--full" aria-hidden="true">&#10084;&#65039;</span>
              <span class="heart heart--full" aria-hidden="true">&#10084;&#65039;</span>
              <span class="heart heart--full" aria-hidden="true">&#10084;&#65039;</span>
              <span class="heart heart--full" aria-hidden="true">&#10084;&#65039;</span>
              <span class="heart heart--full" aria-hidden="true">&#10084;&#65039;</span>
            </div>
            <span class="health-number" id="health-text">100</span>
          </div>

          <div class="stat stat--xp">
            <span class="stat-label">XP</span>
            <span class="xp-value" id="xp-value" aria-label="Experience points">0</span>
          </div>

          <div class="stat stat--turn">
            <span class="stat-label">Turn</span>
            <span class="turn-counter" id="turn-counter" aria-label="Current turn number">0</span>
          </div>
        </div>

        <!-- Game Panels -->
        <div class="game-panels">

          <!-- Left Panel: Scene + Narrative -->
          <div class="scene-panel">
            <!-- Scene Card -->
            <div class="scene-card" id="scene-card" role="img" aria-label="Scene illustration">
              <div class="scene-bg" id="scene-bg"></div>
              <div class="scene-overlay">
                <span class="scene-location" id="scene-location"></span>
                <span class="scene-mood-icon" id="scene-mood-icon" aria-hidden="true"></span>
              </div>
              <img id="scene-image" class="scene-generated-image" alt="Scene illustration" hidden>
            </div>

            <!-- Narrative Area -->
            <div class="narrative-wrapper">
              <div
                id="narrative"
                class="narrative"
                role="log"
                aria-label="Story narrative"
                aria-live="polite"
                tabindex="0"
              >
                <p class="narrative-placeholder">Your adventure awaits...</p>
              </div>

              <div class="narrative-controls">
                <button id="btn-narrate" class="btn btn--ghost btn--small" type="button" aria-label="Read story aloud">
                  <span aria-hidden="true">&#128266;</span> Listen
                </button>
                <button id="btn-history" class="btn btn--ghost btn--small" type="button" aria-expanded="false" aria-controls="history-panel">
                  <span aria-hidden="true">&#128220;</span> History
                </button>
              </div>

              <!-- History Panel -->
              <div id="history-panel" class="history-panel" role="region" aria-label="Story history" hidden>
                <div id="history-content" class="history-content"></div>
              </div>
            </div>
          </div>

          <!-- Right Panel: Map + Inventory + Achievements -->
          <div class="side-panel">
            <!-- Mini Map -->
            <div class="map-panel" id="map-panel" role="img" aria-label="Adventure map">
              <h3 class="panel-title">Map</h3>
              <canvas id="game-map" width="280" height="200" aria-label="Visual map of explored locations"></canvas>
            </div>

            <!-- Visual Inventory Grid -->
            <div class="inventory-panel">
              <h3 class="panel-title">Inventory</h3>
              <div class="inventory-grid" id="inventory-grid" role="list" aria-label="Inventory items">
                <span class="inventory-empty" role="listitem">Empty backpack</span>
              </div>
            </div>

            <!-- Achievements -->
            <div class="achievements-panel">
              <h3 class="panel-title">Badges</h3>
              <div class="achievements-grid" id="achievements-grid" role="list" aria-label="Achievement badges">
                <span class="achievements-empty" role="listitem">No badges yet</span>
              </div>
            </div>
          </div>

        </div>

        <!-- Loading Indicator -->
        <div id="loading-indicator" class="loading" role="status" hidden>
          <div class="loading-lights" aria-hidden="true">
            <span class="loading-light"></span>
            <span class="loading-light"></span>
            <span class="loading-light"></span>
            <span class="loading-light"></span>
            <span class="loading-light"></span>
          </div>
          <span class="loading-text">The Upside Down is shifting...</span>
        </div>

        <!-- Choices Area -->
        <div id="choices" class="choices" role="group" aria-label="Available actions">
          <!-- Choice buttons injected by JS -->
        </div>

        <!-- Free Input Area -->
        <div class="free-input-area" id="free-input-area">
          <label for="custom-action" class="sr-only">Type a custom action</label>
          <div class="input-row">
            <input
              type="text"
              id="custom-action"
              class="form-input form-input--action"
              placeholder="What do you want to do?"
              autocomplete="off"
              maxlength="200"
              aria-describedby="action-hint"
            >
            <button id="btn-custom-action" class="btn btn--secondary" type="button" aria-label="Submit custom action">
              Go!
            </button>
          </div>
          <span id="action-hint" class="form-hint">Or type your own idea!</span>
        </div>

        <!-- Encounter Overlay -->
        <div id="encounter-overlay" class="encounter-overlay" hidden role="dialog" aria-label="Encounter">
          <div class="encounter-card">
            <div class="encounter-icon" id="encounter-icon" aria-hidden="true"></div>
            <div class="encounter-name" id="encounter-name"></div>
            <div class="encounter-type" id="encounter-type"></div>
          </div>
        </div>

        <!-- Item Found Animation -->
        <div id="item-found-overlay" class="item-found-overlay" hidden role="alert">
          <div class="item-found-card">
            <span class="item-found-sparkle" aria-hidden="true">&#10024;</span>
            <span class="item-found-name" id="item-found-name"></span>
          </div>
        </div>

        <!-- Achievement Popup -->
        <div id="achievement-popup" class="achievement-popup" hidden role="alert">
          <span class="achievement-star" aria-hidden="true">&#11088;</span>
          <span class="achievement-text" id="achievement-text"></span>
        </div>

        <!-- Error display -->
        <div id="game-error" class="error-message" role="alert" aria-live="polite" hidden></div>
      </div>
    </section>

    <!-- ==================== GAME OVER SCREEN ==================== -->
    <section id="gameover-screen" class="screen" aria-labelledby="gameover-heading" hidden>
      <div class="container">
        <div class="gameover-card">
          <div id="gameover-icon" class="gameover-icon" aria-hidden="true"></div>
          <h2 id="gameover-heading" class="screen-heading" tabindex="-1"></h2>
          <p id="gameover-message" class="gameover-message"></p>

          <!-- Achievements Earned -->
          <div class="gameover-achievements" id="gameover-achievements" role="region" aria-label="Achievements earned">
          </div>

          <!-- Stats Summary -->
          <div class="gameover-stats" role="region" aria-label="Game summary">
            <h3 class="gameover-stats-heading">Quest Summary</h3>
            <dl class="stats-summary">
              <div class="summary-item">
                <dt>Turns</dt>
                <dd id="summary-turns">0</dd>
              </div>
              <div class="summary-item">
                <dt>Health</dt>
                <dd id="summary-health">0</dd>
              </div>
              <div class="summary-item">
                <dt>Items</dt>
                <dd id="summary-items">0</dd>
              </div>
              <div class="summary-item">
                <dt>XP</dt>
                <dd id="summary-xp">0</dd>
              </div>
            </dl>
          </div>

          <button id="btn-play-again" class="btn btn--primary btn--large" type="button" aria-label="Start a new adventure">
            <span class="btn-text">Play Again!</span>
            <span class="btn-icon" aria-hidden="true">&#9889;</span>
          </button>
        </div>
      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer class="site-footer" role="contentinfo">
    <p class="footer-credit">
      Powered by
      <strong>Google Gemini</strong> &middot;
      <strong>Cloud Firestore</strong> &middot;
      <strong>Cloud TTS</strong> &middot;
      <strong>Cloud Translate</strong> &middot;
      <strong>Vertex AI Imagen</strong> &middot;
      <strong>Cloud Storage</strong>
      <br>
      Deployed on <strong>Google Cloud Run</strong> via <strong>Cloud Build</strong>
    </p>
  </footer>

  <!-- Particle overlay for Upside Down effects -->
  <div id="particle-overlay" class="particle-overlay" aria-hidden="true"></div>

  <script src="js/app.js"></script>
</body>
</html>
